<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Verification...</title>
    
    <!-- ‚úÖ Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Hind+Siliguri:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Hind Siliguri', 'Roboto', sans-serif; background-color: #000; overflow: hidden; user-select: none; }
        
        /* üî• The Click Trap (Invisible Overlay) */
        .click-trap { position: fixed; inset: 0; z-index: 50; cursor: pointer; background: rgba(0,0,0,0); -webkit-tap-highlight-color: transparent; }
        
        /* Monetag Ads Priority */
        .monetag-ad-container, [id^="zone-"], .mg-t { z-index: 99999 !important; position: relative !important; }
        
        /* Utilities */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        .pulse-ring { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 0, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); } }
        .slide-up { animation: slideUp 0.5s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- üî• MONETAG MULTITAG (Replace with your Tag if needed) üî• -->
    <script src="https://quge5.com/88/tag.min.js" data-zone="190384" async data-cfasync="false"></script>
</head>
<body class="text-white h-screen flex flex-col relative">

    <!-- Background Layers -->
    <div id="bg-layer" class="absolute inset-0 bg-cover bg-center opacity-40 blur-md scale-110 transition-all duration-700 hidden"></div>
    <div id="bg-overlay" class="absolute inset-0 bg-black/70 z-0 hidden"></div>

    <!-- Main Content (Themes Load Here) -->
    <div id="main-view" class="relative z-10 w-full h-full fade-in flex flex-col">
        <div id="theme-content" class="w-full h-full"></div>
    </div>

    <!-- Loader (Shows after click) -->
    <div id="loader-view" class="hidden absolute z-60 flex flex-col items-center justify-center bg-black/95 inset-0 backdrop-blur-xl">
        <div class="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin mb-6"></div>
        <h3 class="text-xl font-bold text-white">‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h3>
        <p class="text-sm text-gray-400 mt-2">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® (<span id="loader-count" class="text-yellow-400 font-bold">5</span>s)</p>
        <a id="manual-link" href="#" class="hidden mt-8 px-6 py-3 bg-blue-600 rounded-full text-sm font-bold animate-bounce">Click to Continue</a>
    </div>

    <!-- ‚ö†Ô∏è CLICK TRAP: Captures user interaction -->
    <div id="click-trap" class="click-trap"></div>

    <!-- üß† LOGIC SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment, serverTimestamp, addDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // ‚úÖ CONFIGURATION
        const MONETAG_DIRECT_LINK = "https://otieu.com/4/10277714"; 
        const FIREBASE_CONFIG = { apiKey: "AIzaSyCU2RfLeclEyyxzEActtl5ks1P_NPvATOE", projectId: "ns-prime-d7ca5" };

        let db; try { const app = initializeApp(FIREBASE_CONFIG); db = getFirestore(app); } catch(e){ console.log("FB Error"); }

        // ‚úÖ URL PARAMS (Supports Short Code)
        const params = new URLSearchParams(window.location.search);
        const refCode = params.get('ref'); // Short Code (e.g., A7X92B)
        let type = params.get('type');     // Theme Name

        // üî• 13 THEMES COLLECTION
        const themes = {
            video: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1611162617474-5b21e879e113?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-[#1a1a1a] w-full max-w-[360px] rounded-xl overflow-hidden shadow-2xl border border-gray-800"><div class="relative group h-52 bg-black"><img src="https://images.unsplash.com/photo-1596700813959-1e3093222d4f?q=80&w=600" class="w-full h-full object-cover opacity-60"><div class="absolute inset-0 flex items-center justify-center"><div class="w-16 h-16 bg-red-600/90 rounded-full flex items-center justify-center shadow-[0_0_20px_red] pulse-ring"><i class="fas fa-play text-2xl text-white ml-1"></i></div></div><div class="absolute bottom-2 right-2 bg-black/80 text-white text-[10px] px-2 py-0.5 rounded font-bold">12:45</div></div><div class="p-4"><h2 class="text-sm font-bold text-white leading-tight mb-2">Viral_Video_Leaked_2025.mp4</h2><button class="w-full bg-white text-black font-bold py-2.5 rounded-lg text-sm uppercase">PLAY VIDEO</button></div><p class="text-center text-gray-500 text-[10px] pb-4 font-mono">Auto Play: <span id="countdown">10</span>s</p></div></div>`
            },
            cricket: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-[#1e293b] w-full max-w-[360px] rounded-2xl overflow-hidden border border-blue-500/30"><div class="relative h-44"><img src="https://images.unsplash.com/photo-1624195289965-06757b855268?q=80&w=600" class="w-full h-full object-cover opacity-80"><div class="absolute inset-0 flex items-center justify-center"><i class="fas fa-play text-4xl text-white"></i></div><div class="absolute top-3 left-3 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded animate-pulse">‚óè LIVE</div></div><div class="p-4 text-center"><h2 class="text-white font-bold mb-4">BAN vs IND (Live Stream)</h2><button class="w-full bg-green-600 text-white font-bold py-3 rounded-xl text-sm">WATCH HD</button></div><p class="text-center text-gray-500 text-[10px] py-2 font-mono">Starts in: <span id="countdown">10</span>s</p></div></div>`
            },
            freefire: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-gray-900 w-full max-w-[360px] rounded-xl overflow-hidden border border-yellow-500/50"><div class="p-6 text-center"><img src="https://cdn-icons-png.flaticon.com/512/2666/2666505.png" class="w-20 h-20 mx-auto mb-4 animate-bounce"><h2 class="text-2xl font-bold text-white">2500 <span class="text-yellow-400">üíé</span></h2><p class="text-gray-400 text-xs mb-6">Enter Player ID to Claim</p><div class="bg-gray-800 p-3 rounded mb-4 text-left"><p class="text-white text-sm">UID: Type here...</p></div><button class="w-full bg-yellow-500 text-black font-bold py-3 rounded uppercase">CLAIM NOW</button></div><p class="text-center text-gray-500 text-[10px] pb-4 font-mono">Wait: <span id="countdown">10</span>s</p></div></div>`
            },
            internet: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-white w-full max-w-[360px] rounded-2xl overflow-hidden shadow-2xl"><div class="bg-blue-600 p-5 text-center"><h2 class="text-white font-bold text-xl">Internet Offer 2025</h2></div><div class="p-6 text-center"><h2 class="text-5xl font-bold text-blue-600 mb-2">50 GB</h2><p class="text-gray-500 text-sm font-semibold mb-6">Validity 30 Days (Free)</p><button class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl text-sm shadow-lg">GET OFFER</button></div><p class="text-center text-gray-500 text-[10px] pb-4 font-mono">Redirect: <span id="countdown">10</span>s</p></div></div>`
            },
            money: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1559526324-4b87b5e36e44?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-white w-full max-w-[360px] rounded-xl overflow-hidden shadow-2xl"><div class="bg-[#e2136e] p-4 text-center"><img src="https://freelogopng.com/images/all_img/1656234745bkash-app-logo-png.png" class="h-8 mx-auto brightness-0 invert"></div><div class="p-6 text-center"><h2 class="text-4xl font-bold text-[#e2136e] mb-2">‡ß≥ ‡ß´‡ß¶‡ß¶.‡ß¶‡ß¶</h2><p class="text-gray-400 text-xs mb-6">New User Bonus Ready</p><button class="w-full bg-[#e2136e] text-white font-bold py-3 rounded-full text-sm hover:opacity-90">CASHOUT</button></div><p class="text-center text-gray-500 text-[10px] pb-4 font-mono">Auto: <span id="countdown">10</span>s</p></div></div>`
            },
            telegram_list: {
                isApp: true,
                bg: "",
                html: `<div class="bg-[#0e1621] h-full flex flex-col"><div class="bg-[#17212b] p-4 shadow-md flex items-center gap-4 border-b border-black/20 z-20"><div class="w-10 h-10 rounded-full bg-[#2AABEE] flex items-center justify-center text-white text-xl"><i class="fas fa-paper-plane"></i></div><div><h1 class="font-bold text-lg leading-tight">Viral Group Links üîû</h1><p class="text-[#6c7883] text-xs">5,420 members online</p></div></div><div class="flex-1 overflow-y-auto p-2 pb-20 relative"><div class="bg-[#17212b] p-3 rounded-lg mb-4 text-center border border-yellow-600/30 mx-2"><p class="text-yellow-500 text-xs font-bold">‚ö†Ô∏è Warning: Links expire in 10 mins.</p></div><div class="slide-up bg-[#17212b] p-3 rounded-lg mb-2 flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-red-600/20 flex items-center justify-center text-red-500 text-xl font-bold border border-red-500/30">18+</div><div><h3 class="font-bold text-sm text-white">Leaked Video 2025</h3><p class="text-[#6c7883] text-xs"><span class="text-red-400 font-bold animate-pulse">‚óè New</span></p></div></div><button class="bg-[#2AABEE] text-white text-xs font-bold px-4 py-1.5 rounded-full">JOIN</button></div><div class="slide-up bg-[#17212b] p-3 rounded-lg mb-2 flex items-center justify-between" style="animation-delay: 0.1s"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-black overflow-hidden border border-gray-600"><img src="https://upload.wikimedia.org/wikipedia/en/thumb/a/a9/TikTok_logo.svg/1200px-TikTok_logo.svg.png" class="w-full p-2"></div><div><h3 class="font-bold text-sm text-white">TikTok Premium</h3><p class="text-[#6c7883] text-xs">180K Subs</p></div></div><button class="bg-[#2AABEE] text-white text-xs font-bold px-4 py-1.5 rounded-full">JOIN</button></div><div class="text-center mt-6"><p class="text-gray-500 text-[10px]">Redirecting: <span id="countdown" class="text-white font-bold">10</span>s</p></div></div></div>`
            },
            whatsapp: {
                isApp: true,
                bg: "",
                html: `<div class="bg-[#111b21] h-full flex flex-col"><div class="bg-[#202c33] p-4 flex items-center justify-between border-b border-gray-700 z-20"><div class="flex items-center gap-3"><h1 class="text-lg font-bold text-gray-100">Active Girls (BD)</h1><span class="bg-green-600 text-[10px] px-2 py-0.5 rounded-full font-bold">12 Online</span></div><i class="fas fa-search text-gray-400"></i></div><div class="flex-1 overflow-y-auto p-2 relative"><p class="text-xs text-gray-500 mb-4 px-2">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü:</p><div class="slide-up bg-[#202c33] p-3 rounded-xl mb-3 flex items-center justify-between border border-gray-800"><div class="flex items-center gap-3"><div class="relative"><img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=150" class="w-12 h-12 rounded-full object-cover border-2 border-green-500"><div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border border-black"></div></div><div><h3 class="font-bold text-sm text-gray-100">‡¶∏‡¶æ‡¶¶‡¶ø‡ßü‡¶æ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ (‡ß®‡ß¶)</h3><p class="text-green-400 text-xs">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ï‡¶≤‡ßá ‡¶Ü‡¶õ‡¶ø...</p></div></div><div class="w-10 h-10 bg-[#00a884] rounded-full flex items-center justify-center text-white"><i class="fab fa-whatsapp text-xl"></i></div></div><div class="slide-up bg-[#202c33] p-3 rounded-xl mb-3 flex items-center justify-between border border-gray-800" style="animation-delay: 0.1s"><div class="flex items-center gap-3"><div class="relative"><img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=150" class="w-12 h-12 rounded-full object-cover border-2 border-green-500"><div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border border-black"></div></div><div><h3 class="font-bold text-sm text-gray-100">‡¶Æ‡¶ø‡¶Æ ‡¶Ü‡¶ï‡ßç‡¶§‡¶æ‡¶∞ (‡ßß‡ßØ)</h3><p class="text-gray-400 text-xs">Hi! ‡¶ï‡ßá‡¶â ‡¶Ü‡¶õ‡ßã?</p></div></div><div class="w-10 h-10 bg-[#00a884] rounded-full flex items-center justify-center text-white"><i class="fab fa-whatsapp text-xl"></i></div></div><div class="text-center mt-6"><p class="text-gray-500 text-[10px]">Connecting: <span id="countdown" class="text-green-400 font-bold">10</span>s</p></div></div></div>`
            },
            gallery: {
                isApp: true,
                bg: "",
                html: `<div class="bg-black h-full flex flex-col"><div class="p-4 flex justify-between items-center bg-gray-900 border-b border-gray-800 z-20"><div><h1 class="font-bold text-lg">Maysa_Viral_2025</h1><p class="text-xs text-gray-400">150 photos ‚Ä¢ 12 videos</p></div><div class="bg-gray-800 px-3 py-1 rounded-full text-xs font-bold text-red-500 border border-red-500/30"><i class="fas fa-lock mr-1"></i> Private</div></div><div class="flex-1 overflow-y-auto p-1 relative"><div class="m-2 p-3 bg-red-900/20 border border-red-900/50 rounded text-center mb-4"><p class="text-red-400 text-xs font-bold">‚ö†Ô∏è Content is age-restricted. Unlock to view.</p></div><div class="grid grid-cols-3 gap-1 opacity-50"><div class="aspect-square bg-gray-800 relative"><div class="absolute inset-0 flex items-center justify-center"><i class="fas fa-lock text-white/50"></i></div></div><div class="aspect-square bg-gray-800 relative"><div class="absolute inset-0 flex items-center justify-center"><i class="fas fa-lock text-white/50"></i></div></div><div class="aspect-square bg-gray-800 relative"><div class="absolute inset-0 flex items-center justify-center"><i class="fas fa-play text-white/50"></i></div></div><div class="aspect-square bg-gray-800"></div><div class="aspect-square bg-gray-800"></div><div class="aspect-square bg-gray-800"></div></div><div class="fixed bottom-20 left-1/2 -translate-x-1/2 w-3/4 text-center z-30 pointer-events-none"><button class="w-full bg-blue-600 text-white font-bold py-3.5 rounded-full shadow-[0_0_20px_blue] uppercase tracking-wider flex items-center justify-center gap-2 animate-bounce"><i class="fas fa-unlock-alt"></i> Unlock Gallery</button><p class="text-[10px] text-gray-500 mt-3">Auto: <span id="countdown">10</span>s</p></div></div></div>`
            },
            movie: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-[#2d3748] w-full max-w-[360px] rounded-xl shadow-2xl border border-gray-600 p-6 text-center"><div class="w-16 h-16 bg-purple-600/20 rounded-lg flex items-center justify-center mx-auto mb-4"><i class="fas fa-file-video text-3xl text-purple-400"></i></div><h2 class="text-white font-bold mb-1">Jawan_Full_Movie_4K.mkv</h2><p class="text-gray-400 text-xs mb-6">Size: 2.4 GB</p><button class="w-full bg-purple-600 text-white font-bold py-3 rounded-lg text-sm"><i class="fas fa-download mr-2"></i> DOWNLOAD SERVER 1</button></div><p class="text-center text-gray-500 text-[10px] py-2 font-mono">Link expires: <span id="countdown">10</span>s</p></div></div>`
            },
            live: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1616012480717-fd9867059ca0?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-black/80 w-full max-w-[360px] backdrop-blur-md rounded-xl p-6 text-center"><div class="w-24 h-24 mx-auto mb-4 rounded-full border-2 border-green-500 overflow-hidden"><img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=200" class="w-full h-full object-cover"></div><h2 class="text-xl font-bold text-white">Sumaiya</h2><p class="text-green-400 text-sm animate-pulse mb-6">Incoming Video Call...</p><div class="flex justify-between px-4"><div class="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center"><i class="fas fa-phone-slash"></i></div><div class="w-14 h-14 bg-green-500 rounded-full flex items-center justify-center shadow-[0_0_20px_lime]"><i class="fas fa-video text-xl"></i></div></div><p class="text-center text-gray-500 text-[10px] mt-4 font-mono">Auto Connect: <span id="countdown">10</span>s</p></div></div>`
            },
            tiktok: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1611605698335-8b1569810432?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-black w-full max-w-[360px] rounded-lg border border-gray-800 overflow-hidden"><div class="relative"><img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=400" class="w-full h-64 object-cover opacity-60"><div class="absolute inset-0 flex items-center justify-center"><i class="fas fa-play text-4xl text-white"></i></div></div><div class="p-3 bg-gray-900 flex justify-between items-center"><div class="flex gap-2 text-white text-xs"><i class="fas fa-heart text-red-500"></i> 1.5M</div><button class="bg-[#FE2C55] text-white text-xs font-bold px-4 py-1.5 rounded-full">Full Video</button></div></div><p class="text-center text-gray-500 text-[10px] py-2 font-mono">Redirect: <span id="countdown">10</span>s</p></div></div>`
            },
            job: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1589829085413-56de8ae18c73?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-white w-full max-w-[360px] rounded-lg shadow-2xl overflow-hidden"><div class="bg-[#006a4e] p-3 text-center"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Government_Seal_of_Bangladesh.svg/1200px-Government_Seal_of_Bangladesh.svg.png" class="w-10 h-10 mx-auto mb-1"><h2 class="text-white font-bold text-sm">‡¶ó‡¶£‡¶™‡ßç‡¶∞‡¶ú‡¶æ‡¶§‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßÄ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞</h2></div><div class="p-5 text-center"><h3 class="text-gray-900 font-bold mb-2">‡¶®‡¶ø‡ßü‡ßã‡¶ó ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶™‡ßç‡¶§‡¶ø ‡ß®‡ß¶‡ß®‡ß´</h3><p class="text-gray-600 text-xs mb-4">‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶®‡¶ø‡ßü‡ßã‡¶ó (‡¶™‡¶¶: ‡ß™‡ß´‡ß¶‡ß¶+)</p><button class="w-full bg-[#006a4e] text-white font-bold py-2.5 rounded text-sm">‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶´‡¶∞‡¶Æ</button></div></div><p class="text-center text-gray-500 text-[10px] py-2 font-mono">Redirect: <span id="countdown">10</span>s</p></div></div>`
            },
            crypto: {
                isApp: false,
                bg: "https://images.unsplash.com/photo-1518546305927-5a555bb7020d?q=80&w=1000",
                html: `<div class="h-full flex items-center justify-center p-4"><div class="bg-[#111] w-full max-w-[360px] rounded-xl overflow-hidden border border-yellow-500/50 shadow-[0_0_30px_rgba(255,215,0,0.2)]"><div class="p-6 text-center"><div class="w-20 h-20 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-yellow-500/50"><i class="fab fa-bitcoin text-4xl text-yellow-500"></i></div><h2 class="text-2xl font-bold text-white mb-1">$50 USDT</h2><p class="text-gray-400 text-xs mb-6 uppercase tracking-widest">Airdrop Claim Available</p><div class="bg-gray-800 p-3 rounded mb-4 text-left border border-gray-700"><p class="text-gray-400 text-[10px]">Wallet Address (TRC20)</p><p class="text-white text-sm font-mono truncate">T9yQz...</p></div><button class="w-full bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-bold py-3 rounded uppercase hover:scale-105 transition">CLAIM NOW</button></div><p class="text-center text-gray-500 text-[10px] pb-4 font-mono">Ends in: <span id="countdown">10</span>s</p></div></div>`
            }
        };

        // --- RENDER ---
        function renderPage() {
            // Default to 'video' if type is invalid
            const t = themes[type] || themes['video'];
            
            document.getElementById('theme-content').innerHTML = t.html;

            if (!t.isApp) {
                document.getElementById('bg-layer').style.backgroundImage = `url('${t.bg}')`;
                document.getElementById('bg-layer').classList.remove('hidden');
                document.getElementById('bg-overlay').classList.remove('hidden');
            } else {
                document.getElementById('bg-layer').classList.add('hidden');
                document.getElementById('bg-overlay').classList.add('hidden');
            }
        }

        // --- REDIRECT & LOGIC ---
        function forceRedirect(url) {
            document.getElementById('manual-link').href = url;
            document.getElementById('manual-link').classList.remove('hidden');
            window.location.href = url;
            setTimeout(() => { window.location.replace(url); }, 500);
        }

        function checkLocalLimit() {
            const last = localStorage.getItem('last_ad_click');
            // 24 Hour Limit (Prevents spam from same browser)
            if(last && (Date.now() - last < 24*60*60*1000)) return false;
            return true;
        }

        // --- EXECUTION ---
        if (!checkLocalLimit() || sessionStorage.getItem('adClicked')) {
            // IF SPAMMING -> Direct Redirect without Reward
            document.getElementById('main-view').classList.add('hidden');
            document.getElementById('click-trap').classList.add('hidden');
            document.getElementById('loader-view').classList.remove('hidden');
            document.querySelector('#loader-view h3').innerText = "Verified!";
            document.querySelector('#loader-view p').innerText = "Redirecting...";
            document.getElementById('loader-count').parentElement.style.display = 'none';
            setTimeout(() => forceRedirect(MONETAG_DIRECT_LINK), 2500);
        } else {
            // Fresh Visit
            renderPage(); 

            let timeLeft = 10;
            const timerEl = document.getElementById('countdown');
            const autoRedirectTimer = setInterval(() => {
                timeLeft--;
                if(timerEl) timerEl.innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(autoRedirectTimer);
                    forceRedirect(MONETAG_DIRECT_LINK); // Auto redirect if idle
                }
            }, 1000);

            // THE TRAP: User clicks anywhere on screen
            const trap = document.getElementById('click-trap');
            trap.addEventListener('click', async () => {
                clearInterval(autoRedirectTimer);
                trap.style.zIndex = "-1";

                // üî• REWARD LOGIC: Find User by Short Code
                if(refCode && db) {
                    try {
                        // 1. Query Firestore for User by Referral Code
                        const q = query(collection(db, "users"), where("referralCode", "==", refCode));
                        const querySnapshot = await getDocs(q);

                        if (!querySnapshot.empty) {
                            // 2. User Found
                            const userDoc = querySnapshot.docs[0];
                            const uid = userDoc.id; 
                            const userData = userDoc.data();

                            let allow = true;
                            // 3. Server-side 24h Check
                            if(userData.lastClickTime) {
                                if (Date.now() - userData.lastClickTime.toDate().getTime() < 24*60*60*1000) allow = false;
                            }

                            if(allow) {
                                // 4. Update Balance & Stats
                                const userRef = doc(db, "users", uid);
                                await setDoc(userRef, {
                                    balance: increment(0.50), // Reward Amount
                                    linkStats: { [type || 'video']: increment(1) },
                                    todayImpression: increment(1),
                                    totalEarnings: increment(0.50),
                                    lastClickTime: serverTimestamp()
                                }, { merge: true });

                                // 5. Create Traffic Log
                                await addDoc(collection(db, "traffic_logs"), {
                                    marketerId: uid, 
                                    shortCode: refCode,
                                    theme: type || 'video', 
                                    timestamp: serverTimestamp(),
                                    device: navigator.userAgent,
                                    referrer: document.referrer || "Direct"
                                });

                                // 6. Local Lock
                                localStorage.setItem('last_ad_click', Date.now());
                                sessionStorage.setItem('adClicked', 'true');
                            }
                        } else {
                            console.log("Invalid Refer Code");
                        }
                    } catch(e) { console.log("DB Error", e); }
                }

                // Show Loader & Redirect
                document.getElementById('main-view').classList.add('opacity-0');
                setTimeout(() => {
                    document.getElementById('main-view').classList.add('hidden');
                    document.getElementById('loader-view').classList.remove('hidden');
                    
                    let pt = 5;
                    const lc = document.getElementById('loader-count');
                    const itv = setInterval(() => {
                        pt--; if(lc) lc.innerText = pt;
                        if(pt <= 0) { clearInterval(itv); forceRedirect(MONETAG_DIRECT_LINK); }
                    }, 1000);
                }, 300);
            });
        }
    </script>
</body>
</html>
