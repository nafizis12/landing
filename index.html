<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Secure Gateway</title>
    
    <!-- ‚úÖ Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- üî• AD NETWORK SCRIPTS (Untouched) -->
    <script type="text/javascript" src="https://pl28271319.effectivegatecpm.com/f1/db/ad/f1dbad24f4ca3f9f396837b365a13f63.js"></script>
    <script>(function(s){s.dataset.zone='10278119',s.src='https://nap5k.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <script>(function(s){s.dataset.zone='10334923',s.src='https://gizokraijaw.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>

    <style>
        body { background-color: #000; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; position: relative; }
        #bg-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; filter: blur(12px) brightness(0.3); z-index: -1; transform: scale(1.1); transition: background-image 0.5s ease; }
        .step-section { display: none; opacity: 0; animation: fadeIn 0.6s ease-in-out forwards; }
        .step-active { display: block; opacity: 1; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .instruction-box { background: rgba(220, 38, 38, 0.2); border: 1px solid #ef4444; color: #fca5a5; font-size: 11px; padding: 12px; border-radius: 8px; margin-bottom: 15px; animation: pulseRed 2s infinite; }
        @keyframes pulseRed { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .loader-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .loader-fill { height: 100%; background: linear-gradient(90deg, #f59e0b, #ef4444); width: 0%; transition: width linear; }
        .comment-item { background: rgba(30, 41, 59, 0.8); border-left: 3px solid #3b82f6; padding: 10px; margin-bottom: 8px; border-radius: 6px; }
        #security-loader { position: fixed; inset: 0; background: black; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Security Check Loader -->
    <div id="security-loader">
        <div class="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
        <p class="text-orange-500 mt-4 font-mono text-sm">Verifying Connection...</p>
    </div>

    <div id="bg-layer"></div>

    <div class="fixed top-0 left-0 w-full h-1 bg-gray-800 z-50">
        <div id="top-progress" class="h-full bg-orange-500 w-[33%] transition-all duration-500"></div>
    </div>

    <!-- STEP 1 -->
    <div id="step-1" class="step-section w-full max-w-md">
        <div class="flex justify-between items-center mb-3">
            <span class="text-[10px] font-bold text-gray-400">STEP 1/3</span>
            <span id="badge-text" class="bg-red-600 text-white text-[10px] px-2 py-0.5 rounded font-bold animate-pulse">PREMIUM</span>
        </div>
        
        <!-- Image Container: aspect-video (16:9) for better uncropped image display -->
        <div class="relative w-full aspect-video bg-gray-900 rounded-xl overflow-hidden border border-gray-600 mb-4 shadow-2xl group">
            <img id="theme-img" src="" class="w-full h-full object-cover">
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-black/30">
                <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/30 animate-pulse">
                    <i id="theme-icon" class="fas fa-play text-3xl text-white ml-2"></i>
                </div>
            </div>
        </div>
        
        <h1 id="theme-title" class="text-lg font-bold mb-2 text-white text-center">Loading...</h1>
        <div class="instruction-box">
            <i class="fas fa-shield-alt mr-1"></i> <b>Verification Process:</b>
            <ul id="inst-list" class="list-disc ml-5 mt-1 space-y-1 text-gray-200">
                <!-- Dynamically injected via JS based on category -->
            </ul>
        </div>
        <div class="mt-4">
            <div class="loader-bg"><div id="bar-1" class="loader-fill"></div></div>
            <p id="text-1" class="text-center text-xs text-orange-400 mt-2 font-mono">Checking Server... 7s</p>
            <button id="btn-1" class="w-full mt-3 bg-gray-800 text-gray-500 font-bold py-3.5 rounded-lg cursor-not-allowed border border-gray-700">PLEASE WAIT...</button>
        </div>
    </div>

    <!-- STEP 2 -->
    <div id="step-2" class="step-section w-full max-w-md">
        <div class="flex items-center gap-3 mb-4 bg-gray-800/80 p-3 rounded-lg border border-gray-600">
            <img id="thumb-img" src="" class="w-12 h-12 rounded object-cover">
            <div><h2 class="text-sm font-bold text-white">Establishing Connection</h2><p class="text-[10px] text-green-400 animate-pulse">‚óè Source Found (Ready)</p></div>
        </div>
        <div id="comment-box" class="h-60 overflow-y-auto bg-black/50 rounded-xl p-3 border border-gray-700 mb-4 relative"></div>
        <div>
            <div class="loader-bg"><div id="bar-2" class="loader-fill"></div></div>
            <p id="text-2" class="text-center text-xs text-yellow-500 mt-2 font-mono">Finalizing Link... 15s</p>
            <button id="btn-2" class="w-full mt-2 bg-gray-800 text-gray-500 font-bold py-3.5 rounded-lg cursor-not-allowed">READING LOGS...</button>
        </div>
    </div>

    <!-- STEP 3 -->
    <div id="step-3" class="step-section w-full max-w-md text-center">
        <div class="mb-5"><div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3 shadow-[0_0_20px_lime]"><i class="fas fa-check text-3xl text-white"></i></div><h2 id="final-title" class="text-xl font-bold text-white">Access Granted!</h2></div>
        <div class="space-y-3">
            <button onclick="handleFinal('adsterra')" class="w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl border border-gray-600 flex items-center justify-between group transition">
                <div class="flex items-center gap-3"><div class="bg-yellow-500/20 p-2 rounded-full"><i class="fas fa-bolt text-yellow-500"></i></div><div class="text-left"><h3 id="final-btn-1-text" class="font-bold text-sm text-gray-200">Server 1 (Fast)</h3><p class="text-[9px] text-gray-500">Recommended</p></div></div><i class="fas fa-chevron-right text-gray-500 group-hover:text-white"></i>
            </button>
            <button onclick="handleFinal('real')" class="w-full bg-green-900/40 hover:bg-green-800/60 p-3 rounded-xl border border-green-700/50 flex items-center justify-between group transition">
                <div class="flex items-center gap-3"><div class="bg-green-500/20 p-2 rounded-full"><i id="final-icon" class="fas fa-play text-green-500"></i></div><div class="text-left"><h3 id="final-btn-2-text" class="font-bold text-sm text-gray-200">Server 2 (Original)</h3><p class="text-[9px] text-gray-400">No Ads ‚Ä¢ Secure</p></div></div><i class="fas fa-check text-gray-500 group-hover:text-white"></i>
            </button>
        </div>
    </div>

    <!-- üß† FIREBASE & SECURE LOGIC SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, doc, setDoc, increment, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const CONFIG = {
            MAX_ACCESS: 3, 
            REDIRECT_URL: "https://www.google.com", 
            LINKS: {
                adsterra: "https://www.effectivegatecpm.com/v7q3h5hn0i?key=20a1143be5316e1ad5698ad420634135", 
                monetag: "https://otieu.com/4/10277714",
                content: "https://tinyurl.com/video-platfrom" 
            },
            FIREBASE: { 
                apiKey: "AIzaSyCU2RfLeclEyyxzEActtl5ks1P_NPvATOE", 
                authDomain: "ns-prime-d7ca5.firebaseapp.com",
                projectId: "ns-prime-d7ca5",
                storageBucket: "ns-prime-d7ca5.firebasestorage.app",
                messagingSenderId: "172231719671",
                appId: "1:172231719671:web:3dafc0ace7b44fbe0071f2"
            }
        };

        const app = initializeApp(CONFIG.FIREBASE);
        const db = getFirestore(app);
        const params = new URLSearchParams(window.location.search);
        const refCode = params.get('ref') || params.get('u'); 
        const type = params.get('type') || 'video';

        // --- üõ°Ô∏è Active IP & Device Security Protection ---
        async function checkSecurity() {
            const today = new Date().toDateString();
            let lCount = parseInt(localStorage.getItem('v_cnt')) || 0;
            let lDate = localStorage.getItem('v_date');
            
            // Check LocalStorage limit
            if (lDate === today && lCount >= CONFIG.MAX_ACCESS) { 
                window.location.replace(CONFIG.REDIRECT_URL); 
                return false; 
            }

            try {
                // Fetch IP Address
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                const userIP = ipData.ip.replace(/\./g, '_'); 

                const ipDocRef = doc(db, "ip_logs", userIP);
                const ipSnap = await getDoc(ipDocRef);

                // Check Firestore IP Limit
                if (ipSnap.exists()) {
                    const data = ipSnap.data();
                    if (data.date === today && data.count >= CONFIG.MAX_ACCESS) { 
                        window.location.replace(CONFIG.REDIRECT_URL); 
                        return false; 
                    }
                    await setDoc(ipDocRef, { count: data.date === today ? increment(1) : 1, date: today }, { merge: true });
                } else { 
                    await setDoc(ipDocRef, { count: 1, date: today }); 
                }

                // Update LocalStorage Count
                localStorage.setItem('v_date', today);
                localStorage.setItem('v_cnt', lDate === today ? lCount + 1 : 1);
                return true;

            } catch (e) {
                console.error("Sync Error:", e);
                // Fallback: Use LocalStorage if IP fetch fails
                localStorage.setItem('v_date', today);
                localStorage.setItem('v_cnt', lDate === today ? lCount + 1 : 1);
                return true; 
            }
        }

        // --- üéØ DATA MAPPING (20 Niches - With NEW Images) ---
        const DATA = {
            video: { title: "Private Video Leaked_Full.mp4", img: "https://i.postimg.cc/Yq59W5DR/ecc275af-8d5c-42bb-8169-d41694925e44.jpg", icon: "fa-play", badge: "VIRAL", btn: "VERIFY & WATCH", comments: ["Video is playing fine, thanks!", "Have to wait a bit but works.", "HD Quality confirmed."] },
            tiktok: { title: "Viral TikTok Video Leaked", img: "https://i.postimg.cc/FztNrMn6/ztoop2xo.jpg", icon: "fa-tiktok", badge: "VIRAL", btn: "WATCH VIDEO", comments: ["Got the video thanks."] },
            movie: { title: "Jawan_4K_HDRip.mkv (2.8 GB)", img: "https://i.postimg.cc/4ytydJSD/vtjur3ya.jpg", icon: "fa-film", badge: "MOVIE", btn: "DOWNLOAD MOVIE", comments: ["Print quality is super HD."] },
            live: { title: "Incoming Video Call...", img: "https://i.postimg.cc/FztNrMn6/ztoop2xo.jpg", icon: "fa-video", badge: "CALLING", btn: "ANSWER CALL", comments: ["Connected to the call."] },
            gallery: { title: "Unlock Private Gallery", img: "https://i.postimg.cc/QC5CtXzG/8tb1xjxq.jpg", icon: "fa-images", badge: "LOCKED", btn: "UNLOCK ALBUM", comments: ["Album unlocked completely."] },
            freefire: { title: "5000 Diamonds Redeem Code", img: "https://i.postimg.cc/tRVYD54T/0ig94yyg.jpg", icon: "fa-gem", badge: "GARENA", btn: "GET CODE", comments: ["Code worked! Thanks bro."] },
            roblox: { title: "10,000 Free Robux Generator", img: "https://i.postimg.cc/3rDd9Bxk/6rfn1ocv.jpg", icon: "fa-gamepad", badge: "ROBUX", btn: "GENERATE ROBUX", comments: ["Bought new skins with this!", "OMG it actually worked.", "Verified and received 10k."] },
            vbucks: { title: "13,500 V-Bucks Gift Card", img: "https://i.postimg.cc/CMfzJNxB/q7n2asel.jpg", icon: "fa-coins", badge: "FORTNITE", btn: "CLAIM V-BUCKS", comments: ["Got the new battle pass!", "Vbucks added instantly.", "Best generator so far."] },
            monopoly: { title: "99,999 Monopoly Go Free Dice", img: "https://i.postimg.cc/nVQCTkh9/h7fn6han.jpg", icon: "fa-dice", badge: "FREE DICE", btn: "ADD DICE NOW", comments: ["My account just got the dice!", "No ban, completely safe.", "Rolling all day now lol."] },
            cashapp: { title: "$750 Cash App Transfer", img: "https://i.postimg.cc/h47fMrtY/lpfj2x6h.jpg", icon: "fa-money-bill-wave", badge: "CASH MONEY", btn: "RECEIVE MONEY", comments: ["Money hit my account!", "Thanks for the $750.", "Paid off my bills thanks to this."] },
            amazon: { title: "$100 Amazon Gift Card Free", img: "https://i.postimg.cc/WbLtykdY/uzxah1ts.jpg", icon: "fa-amazon", badge: "GIFT CARD", btn: "CLAIM $100 NOW", comments: ["Just got the code sent to my email!", "Wow, didn't think this would work.", "100% legit thanks!"] },
            apple: { title: "$50 Apple/iTunes Gift Card", img: "https://i.postimg.cc/59F6p32P/8md5a3vb.jpg", icon: "fa-apple", badge: "APPLE CODE", btn: "REDEEM CODE", comments: ["Added $50 to my Apple ID.", "Working properly, thank you.", "Super fast delivery."] },
            xbox: { title: "Xbox Game Pass & $50 Card", img: "https://i.postimg.cc/L4ZnvT83/8i4spybd.jpg", icon: "fa-xbox", badge: "XBOX LIVE", btn: "GENERATE CODE", comments: ["Game pass activated!", "Thanks bro, got the code.", "Using it for new games now."] },
            money: { title: "Cashback Bonus: ‡ß≥500.00", img: "https://i.postimg.cc/02Rr4wzH/xzle9t0h.jpg", icon: "fa-gift", badge: "CASH", btn: "CLAIM BONUS", comments: ["Received the money!", "Legit offer indeed."] },
            crypto: { title: "$50.00 USDT Airdrop", img: "https://i.postimg.cc/m2fhnHPV/n6zkxmy3.jpg", icon: "fa-bitcoin", badge: "CRYPTO", btn: "CLAIM USDT", comments: ["Received 10 USDT in wallet."] },
            internet: { title: "50 GB Free Internet Data", img: "https://i.postimg.cc/5yw16shd/Whisk_a36e70acf894517a9454d6d13cddecbedr.jpg", icon: "fa-wifi", badge: "DATA", btn: "ACTIVATE NOW", comments: ["Received on my sim.", "30 days validity confirmed."] },
            cricket: { title: "Live Match: BAN vs IND (HD)", img: "https://i.postimg.cc/ryPF6tz7/images.png", icon: "fa-tv", badge: "LIVE", btn: "WATCH STREAM", comments: ["No buffering finally!", "Streaming in full HD."] },
            job: { title: "Govt. Job Circular 2026.pdf", img: "https://i.postimg.cc/sfNDFZ1N/download_(29).jpg", icon: "fa-file-pdf", badge: "GOVT", btn: "DOWNLOAD PDF", comments: ["PDF downloaded perfectly.", "Applying right now, thanks.", "Authentic circular file."] },
            whatsapp: { title: "Join Private WhatsApp Group", img: "https://i.postimg.cc/sfNDFZvd/download_(28).jpg", icon: "fa-whatsapp", badge: "CHAT", btn: "JOIN GROUP", comments: ["Joined successfully."] },
            telegram: { title: "Premium Leaks Channel (18+)", img: "https://i.postimg.cc/ryPF6tz7/images.png", icon: "fa-telegram-plane", badge: "PRIVATE", btn: "JOIN CHANNEL", comments: ["Premium contents inside!"] }
        };

        async function trackVisitAndBalance() {
            if(!refCode) return;
            try {
                const [settingsSnap, userSnap] = await Promise.all([
                    getDoc(doc(db, "settings", "config")),
                    getDoc(doc(db, "users", refCode))
                ]);
                let globalCpm = settingsSnap.exists() ? (settingsSnap.data().globalCpm || 0) : 0;
                let userCustomCpm = (userSnap.exists() && userSnap.data().customCpm > 0) ? userSnap.data().customCpm : 0;
                let earning = (userCustomCpm > 0 ? userCustomCpm : globalCpm) / 1000;

                await setDoc(doc(db, "users", refCode), {
                    rawTotalImpressions: increment(1),
                    rawTodayImpressions: increment(1),
                    validClicks: increment(1),
                    balance: increment(earning),
                    todayEarning: increment(earning),
                    totalEarnings: increment(earning),
                    lastActive: serverTimestamp()
                }, { merge: true });
            } catch (e) {}
        }

        async function trackButtonClick() {
            if(!refCode) return;
            try { await setDoc(doc(db, "users", refCode), { totalClicks: increment(1), todayClicks: increment(1) }, { merge: true }); } catch (e) {}
        }

        // Global Variable for Step 2 button text
        window.currentActionWord = "Access";

        async function init() {
            const isSafe = await checkSecurity();
            if (!isSafe) return;

            document.getElementById('security-loader').style.display = 'none';
            document.getElementById('step-1').classList.add('step-active');

            const t = DATA[type] || DATA['video'];
            document.getElementById('bg-layer').style.backgroundImage = `url('${t.img}')`;
            document.getElementById('theme-img').src = t.img;
            document.getElementById('thumb-img').src = t.img;
            document.getElementById('theme-title').innerText = t.title;
            
            // Icon fixing
            document.getElementById('theme-icon').className = `fas ${t.icon} text-3xl text-white ${['fa-play'].includes(t.icon) ? 'ml-2' : ''}`;
            document.getElementById('badge-text').innerText = t.badge;
            
            // Dynamic Logic based on category
            let actionWord = "Access";
            let fBtn1 = "Server 1 (Fast)";
            let fBtn2 = "Server 2 (Secure)";

            if(['job','movie','gallery'].includes(type)) {
                actionWord = "Download";
                fBtn1 = "Download Server 1";
                fBtn2 = "Direct Download (Secure)";
                document.getElementById('final-icon').className = "fas fa-download text-green-500";
            } else if(['amazon','apple','xbox','cashapp','money','crypto','internet'].includes(type)) {
                actionWord = "Claim";
                fBtn1 = "Sponsor Server (Fast)";
                fBtn2 = "Claim Reward (Secure)";
                document.getElementById('final-icon').className = "fas fa-unlock text-green-500";
            } else if(['monopoly','roblox','vbucks','freefire'].includes(type)) {
                actionWord = "Generate";
                fBtn1 = "Fast Injection";
                fBtn2 = "Direct Generator (Safe)";
                document.getElementById('final-icon').className = "fas fa-cogs text-green-500";
            } else if(['whatsapp','telegram'].includes(type)) {
                actionWord = "Join";
                fBtn1 = "Join via Server 1";
                fBtn2 = "Direct Join Link";
                document.getElementById('final-icon').className = "fas fa-user-plus text-green-500";
            } else {
                actionWord = "Watch";
                fBtn1 = "Stream Server 1";
                fBtn2 = "Direct Play (No Ads)";
                document.getElementById('final-icon').className = "fas fa-play text-green-500";
            }

            window.currentActionWord = actionWord;

            // Updating Dynamic Texts
            document.getElementById('inst-list').innerHTML = `
                <li>Click the verification button below to <b>${actionWord}</b>.</li>
                <li>If a new page or ad opens, close it and return here.</li>
            `;
            document.getElementById('final-title').innerText = `${actionWord} Granted!`;
            document.getElementById('final-btn-1-text').innerText = fBtn1;
            document.getElementById('final-btn-2-text').innerText = fBtn2;

            // Setup Comments
            const commentBox = document.getElementById('comment-box');
            let html = `<div class="comment-item"><span class="block font-bold text-[10px] text-green-400">> System Logs</span><p class="text-[10px] font-mono">Status... Verified OK</p></div>`;
            t.comments.forEach(c => {
                html += `<div class="comment-item"><span class="block font-bold text-[10px] text-blue-400">User_${Math.floor(Math.random()*9999)}</span><p class="text-xs text-gray-300">${c}</p></div>`;
            });
            commentBox.innerHTML = html;

            trackVisitAndBalance();
            runStep1(t.btn);
        }

        function runStep1(btnText) {
            let t = 7;
            const bar = document.getElementById('bar-1'), txt = document.getElementById('text-1'), btn = document.getElementById('btn-1');
            bar.style.transition = `width ${t}s linear`;
            setTimeout(() => bar.style.width = "100%", 50);
            const timer = setInterval(() => {
                t--;
                txt.innerText = `Connecting... ${t}s`;
                if(t <= 0) {
                    clearInterval(timer);
                    txt.innerText = "Server Ready!";
                    btn.innerHTML = `${btnText} <i class="fas fa-arrow-right ml-2"></i>`;
                    btn.className = "w-full mt-3 bg-red-600 hover:bg-red-700 text-white font-bold py-3.5 rounded-lg shadow-[0_0_15px_red] transition-all animate-pulse cursor-pointer";
                    btn.onclick = () => {
                        trackButtonClick();
                        window.open(CONFIG.LINKS.adsterra, '_blank');
                        changeStep('step-1', 'step-2', '66%');
                        runStep2();
                    };
                }
            }, 1000);
        }

        function runStep2() {
            let t = 15;
            const bar = document.getElementById('bar-2'), txt = document.getElementById('text-2'), btn = document.getElementById('btn-2');
            bar.style.transition = `width ${t}s linear`;
            setTimeout(() => bar.style.width = "100%", 50);
            const timer = setInterval(() => {
                t--;
                txt.innerText = `Finalizing ${window.currentActionWord}... ${t}s`;
                if(t <= 0) {
                    clearInterval(timer);
                    txt.innerText = "Success!";
                    btn.innerHTML = `PROCEED TO ${window.currentActionWord.toUpperCase()} <i class="fas fa-lock-open ml-2"></i>`;
                    btn.className = "w-full mt-2 bg-green-600 hover:bg-green-700 text-white font-bold py-3.5 rounded-lg cursor-pointer";
                    btn.onclick = () => changeStep('step-2', 'step-3', '100%');
                }
            }, 1000);
        }

        window.handleFinal = (type) => {
            trackButtonClick();
            if(type === 'real') window.location.href = CONFIG.LINKS.content;
            else window.open(CONFIG.LINKS[type], '_blank');
        };

        function changeStep(h, s, p) {
            document.getElementById(h).classList.remove('step-active');
            setTimeout(() => document.getElementById(s).classList.add('step-active'), 100);
            document.getElementById('top-progress').style.width = p;
        }

        init();
    </script>
</body>
</html>
