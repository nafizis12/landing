<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="noindex, nofollow">
    <title>Link Gateway</title>
    
    <!-- ‚úÖ Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; overflow-x: hidden; user-select: none; }
        
        /* üõ°Ô∏è Clean Glass UI (No Misleading Elements) */
        .glass-panel {
            background: rgba(15, 15, 20, 0.95);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        
        /* üõ°Ô∏è Ad Overlap Protection (Spacing) */
        .safe-spacing { margin-top: 20px; margin-bottom: 20px; }

        .hidden { display: none !important; }
        .disabled-btn { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); pointer-events: none; }
        
        /* Loading Animation */
        .loader-bar { height: 4px; background: #222; border-radius: 2px; overflow: hidden; width: 100%; margin: 15px 0; }
        .loader-fill { height: 100%; background: #3b82f6; width: 0%; transition: width 0.5s linear; }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col relative bg-gray-950">

    <!-- üåå Background (Clean, Abstract) -->
    <div class="absolute inset-0 bg-gradient-to-br from-gray-900 via-black to-gray-900 z-0"></div>

    <!-- üõ°Ô∏è LAYER 1: BOT PROTECTION (Interaction Check) -->
    <div id="bot-trap" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/95">
        <div class="p-6 text-center">
            <i class="fas fa-shield-halved text-4xl text-gray-600 mb-4"></i>
            <p class="text-sm text-gray-400 mb-2">Security Check</p>
            <p class="text-xs text-gray-600 animate-pulse">Click anywhere to verify connection</p>
        </div>
    </div>

    <!-- üì¶ Main Content -->
    <div id="main-view" class="relative z-10 w-full min-h-screen flex flex-col items-center justify-center p-4 opacity-0 transition-opacity duration-700">
        <div id="theme-content" class="w-full max-w-md"></div>
        
        <!-- Disclaimer (Safety Requirement) -->
        <div class="mt-8 opacity-30 text-[10px] text-center max-w-xs mx-auto">
            <p>This page may contain sponsored links. You will be redirected to your destination after verification.</p>
        </div>
    </div>

    <!-- üß† LOGIC SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment, serverTimestamp, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // ==========================================
        // ‚öôÔ∏è SAFE CONFIGURATION
        // ==========================================
        const CONFIG = {
            MONETAG_LINK: "https://otieu.com/4/10277714", 
            SAFE_PAGE: "https://www.google.com", 
            MONETAG_SCRIPT: "https://quge5.com/88/tag.min.js",
            ZONE_ID: "190384",
            MAX_DAILY_VIEWS: 5, // ‡¶™‡ßç‡¶∞‡¶§‡¶ø IP ‡ß´ ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶≤‡ßá ‡¶¨‡ßç‡¶≤‡¶ï
            MIN_SESSION_TIME: 5000, // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ (‡¶®‡ßç‡¶Ø‡¶æ‡¶ö‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ)
            FIREBASE: { 
                apiKey: "AIzaSyCU2RfLeclEyyxzEActtl5ks1P_NPvATOE", 
                projectId: "ns-prime-d7ca5" 
            }
        };

        let db; try { const app = initializeApp(CONFIG.FIREBASE); db = getFirestore(app); } catch(e){}

        const params = new URLSearchParams(window.location.search);
        const refCode = params.get('ref'); 
        const type = params.get('type') || 'video';

        // ==========================================
        // üé® SAFE THEMES (No Fake Players/Buttons)
        // ==========================================
        // ‡¶Ü‡¶Æ‡¶∞‡¶æ "Play" ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡¶∞‡¶ø‡ßü‡ßá "Continue" ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§
        const themes = {
            video: {
                icon: "fas fa-video",
                title: "Video Content",
                desc: "Viral_Video_2025.mp4",
                dest: "https://www.youtube.com/results?search_query=viral+video",
                color: "blue"
            },
            job: {
                icon: "fas fa-briefcase",
                title: "Job Circular",
                desc: "Official Recruitment 2025",
                dest: "http://www.bangladesh.gov.bd/site/view/job_category/",
                color: "green"
            },
            cricket: {
                icon: "fas fa-baseball-bat-ball",
                title: "Live Score",
                desc: "BAN vs IND Match Update",
                dest: "https://www.cricbuzz.com/",
                color: "green"
            },
            money: {
                icon: "fas fa-wallet",
                title: "Cashback Offer",
                desc: "Exclusive Deal Pending",
                dest: "https://www.bkash.com/offers",
                color: "pink"
            },
            freefire: {
                icon: "fas fa-gamepad",
                title: "Game Rewards",
                desc: "Diamond Bundle Pack",
                dest: "https://ff.garena.com/en/",
                color: "yellow"
            },
            whatsapp: {
                icon: "fab fa-whatsapp",
                title: "Chat Request",
                desc: "Connect via WhatsApp",
                dest: "https://web.whatsapp.com/",
                color: "green"
            },
            telegram: {
                icon: "fab fa-telegram",
                title: "Channel Invite",
                desc: "Join Private Group",
                dest: "https://telegram.org/",
                color: "blue"
            },
            internet: {
                icon: "fas fa-wifi",
                title: "Data Pack",
                desc: "Internet Offer Details",
                dest: "https://www.google.com/search?q=internet+offer",
                color: "blue"
            },
            gallery: {
                icon: "fas fa-images",
                title: "Private Album",
                desc: "Secure Photo Gallery",
                dest: "https://photos.google.com/",
                color: "red"
            },
            movie: {
                icon: "fas fa-film",
                title: "Movie Info",
                desc: "HD Quality Details",
                dest: "https://www.imdb.com/",
                color: "purple"
            },
            live: {
                icon: "fas fa-headset",
                title: "Live Support",
                desc: "Video Call Request",
                dest: "https://zoom.us/",
                color: "blue"
            },
            tiktok: {
                icon: "fab fa-tiktok",
                title: "Viral Clip",
                desc: "Trending on TikTok",
                dest: "https://www.tiktok.com/",
                color: "pink"
            },
            crypto: {
                icon: "fab fa-bitcoin",
                title: "Crypto Airdrop",
                desc: "USDT Voucher Info",
                dest: "https://coinmarketcap.com/",
                color: "yellow"
            }
        };

        // ==========================================
        // üõ°Ô∏è SECURITY SYSTEM (Client Side Firewall)
        // ==========================================

        async function init() {
            // 1. Bot Filter (Immediate)
            if(isBot()) {
                window.location.href = CONFIG.SAFE_PAGE;
                return;
            }

            // 2. Render UI
            renderUI();

            // 3. Interaction Trap (Wait for user action)
            ['click', 'touchstart'].forEach(evt => 
                window.addEventListener(evt, startSession, {once: true})
            );
        }

        function isBot() {
            // A. Headless Check
            if (navigator.webdriver) return true;
            // B. User Agent Check
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('bot') || ua.includes('crawl') || ua.includes('spider')) return true;
            // C. Bad Referrer Block
            const ref = document.referrer.toLowerCase();
            if (ref.includes('traffic') || ref.includes('bot') || ref.includes('exchange')) return true;
            
            return false;
        }

        function renderUI() {
            const t = themes[type] || themes['video'];
            
            // Generate Safe Color Classes
            let btnColor = "bg-blue-600 hover:bg-blue-700";
            if(t.color === 'green') btnColor = "bg-green-600 hover:bg-green-700";
            if(t.color === 'pink') btnColor = "bg-pink-600 hover:bg-pink-700";
            if(t.color === 'yellow') btnColor = "bg-yellow-600 hover:bg-yellow-700";
            
            const html = `
                <div class="glass-panel rounded-xl p-8 text-center border-t-4 border-${t.color}-500">
                    <div class="w-16 h-16 mx-auto bg-gray-800 rounded-full flex items-center justify-center mb-4 shadow-lg">
                        <i class="${t.icon} text-3xl text-gray-200"></i>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-white mb-1">${t.title}</h2>
                    <p class="text-sm text-gray-400 mb-6">${t.desc}</p>
                    
                    <!-- Progress Bar (Fake but realistic) -->
                    <div class="text-left mb-2 text-[10px] text-gray-500 font-mono">STATUS: <span id="status-text" class="text-blue-400">WAITING...</span></div>
                    <div class="loader-bar">
                        <div id="progress-bar" class="loader-fill"></div>
                    </div>

                    <!-- SAFE SPACING (Ad Overlap Protection) -->
                    <div class="safe-spacing"></div>

                    <!-- CONTINUE BUTTON (Starts Disabled) -->
                    <button id="cta-btn" class="w-full ${btnColor} text-white font-bold py-4 rounded-lg shadow-lg transition-all transform active:scale-95 disabled-btn">
                        PLEASE WAIT...
                    </button>
                </div>
            `;
            document.getElementById('theme-content').innerHTML = html;
        }

        async function startSession() {
            // Remove Trap
            document.getElementById('bot-trap').remove();
            document.getElementById('main-view').classList.remove('opacity-0');

            // Inject Ad Script (1 Multitag Only)
            const script = document.createElement('script');
            script.src = CONFIG.MONETAG_SCRIPT;
            script.dataset.zone = CONFIG.ZONE_ID;
            document.body.appendChild(script);

            // Start Frequency Check & Timer Parallelly
            const isAllowed = await checkFrequency();
            runTimer(isAllowed);
        }

        async function checkFrequency() {
            if (!db) return true; // Fail safe
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                window.userIP = data.ip.replace(/\./g, '_');

                // Check Daily Limit
                const ipRef = doc(db, "visitor_locks", window.userIP);
                const ipSnap = await getDoc(ipRef);

                if (ipSnap.exists()) {
                    const d = ipSnap.data();
                    const now = new Date();
                    const last = d.timestamp.toDate();
                    
                    // Reset count if new day
                    if(now.getDate() !== last.getDate()) {
                        await setDoc(ipRef, { count: 1, timestamp: serverTimestamp() }, { merge: true });
                        return true;
                    }
                    
                    if (d.count >= CONFIG.MAX_DAILY_VIEWS) {
                        return false; // Limit Exceeded
                    } else {
                        await setDoc(ipRef, { count: increment(1), timestamp: serverTimestamp() }, { merge: true });
                        return true;
                    }
                } else {
                    await setDoc(ipRef, { count: 1, timestamp: serverTimestamp() });
                    return true;
                }
            } catch (e) {
                return true; 
            }
        }

        function runTimer(isAllowed) {
            const bar = document.getElementById('progress-bar');
            const btn = document.getElementById('cta-btn');
            const status = document.getElementById('status-text');
            
            if(!isAllowed) {
                status.innerText = "LIMIT EXCEEDED";
                setTimeout(() => window.location.href = CONFIG.SAFE_PAGE, 2000);
                return;
            }

            status.innerText = "VERIFYING CONNECTION...";
            bar.style.width = "100%"; // 5s transition via CSS

            setTimeout(() => {
                // Session Time Passed -> Enable Button
                status.innerText = "READY";
                btn.classList.remove('disabled-btn');
                btn.innerText = "CONTINUE";
                
                // Add Click Handler
                btn.onclick = handleClick;
            }, CONFIG.MIN_SESSION_TIME);
        }

        async function handleClick() {
            const btn = document.getElementById('cta-btn');
            btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> PROCESSING...`;
            
            // 1. Log Conversion (Firebase)
            await trackConversion();

            // 2. Open Ad (New Tab - Safe Popunder)
            window.open(CONFIG.MONETAG_LINK, '_blank');

            // 3. Redirect Main Tab to Real Content (User Satisfaction)
            const t = themes[type] || themes['video'];
            setTimeout(() => {
                window.location.href = t.dest;
            }, 800);
        }

        async function trackConversion() {
            if (!refCode || !db || !window.userIP) return;
            try {
                const q = query(collection(db, "users"), where("referralCode", "==", refCode));
                const snap = await getDocs(q);
                if (!snap.empty) {
                    const uid = snap.docs[0].id;
                    await setDoc(doc(db, "users", uid), {
                        todayImpression: increment(1),
                        totalEarnings: increment(0.50), // Adjust rate as needed
                        lastClickTime: serverTimestamp()
                    }, { merge: true });
                }
            } catch (e) {}
        }

        // Start
        init();
    </script>
</body>
</html>
